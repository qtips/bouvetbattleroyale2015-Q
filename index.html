<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<script src='js/settings.js'></script>
	<script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
	<script src='js/functions.js'></script>
	<script src="//maps.google.com/maps/api/js" type="text/javascript"></script>
</head>
<script lang="javascript">

	var goldStar = {
		path: 'M 125,5 155,90 245,90 175,145 200,230 125,180 50,230 75,145 5,90 95,90 z',
		fillColor: 'yellow',
		fillOpacity: 0.3,
		scale: 0.1,
		strokeColor: 'gold',
		strokeWeight: 2
	};

	$(document).ready(function() {
		register();

		var options = {
			enableHighAccuracy: true,
			timeout: 5000,
			maximumAge: 0
		};

		function success(pos) {
			var crd = pos.coords;

			var locations = [];
			getState(function updateMap(data){
				var posts = data.poster;
				for (x = 0; x < posts.length; x++) {
					locations.push([JSON.stringify(posts[x].poengVerdi), posts[x].latitude, posts[x].longitude, 4]);
				}
				locations.push(['You!', crd.latitude, crd.longitude, 0]);

				var map = new google.maps.Map(document.getElementById('map'), {
					zoom: 17,
					center: new google.maps.LatLng(crd.latitude, crd.longitude),
					mapTypeId: google.maps.MapTypeId.ROADMAP
				});

				var infowindow = new google.maps.InfoWindow();
				var marker, i;
				for (i = 0; i < locations.length; i++) {
					if (locations[i][0] == 'You!') {
						marker = new google.maps.Marker({
							position: new google.maps.LatLng(locations[i][1], locations[i][2]),
							icon: goldStar,
							map: map
						});
					} else {
						marker = new google.maps.Marker({
							position: new google.maps.LatLng(locations[i][1], locations[i][2]),
							map: map
						});
					}

					google.maps.event.addListener(marker, 'click', (function(marker, i) {
						return function() {
							infowindow.setContent(locations[i][0]);
							infowindow.open(map, marker);
						}
					})(marker, i));
				}

			});
		};

		function error(err) {
			console.warn('ERROR(' + err.code + '): ' + err.message);
		};

		navigator.geolocation.getCurrentPosition(success, error, options);
	});
</script>

<body>
<span>Velg person</span>
<select id="person">
	<option value='96625909'>Gareth</option>
	<option value='41469772'>Inge</option>
	<option value='99787444'>Karianne</option>
	<option value='47610324'>Qadeer</option>
</select>
<h3>Hendelseslogg - felleskanal</h3>
</br>

<div id="meldinger"></div>
<form name="hendelseslogg" action="" method="GET">

</form>
<div>
	<span>Melding:</span><input id="message-to-send" onkeypress="sendMessageOnEnter" type="text" /> <button onclick="doSendMessage()">Send</button>
	
</div>
</br>
</br>
	<div>
        <h3>Registrer post: </h3>
	</div>
	<div id="register">
		<input id='postkode' type="text" placeholder="Tast inn kode" />
		<button onclick="register()">Registrer</button>
		<button onclick="register('BOMBE')">Registrer m/bombe</button>
		<button onclick="register('FELLE')">Registrer m/felle</button>	
	</div>

	<div id="map" style="width: 600px; height: 400px;"></div>

	<div id="messages">
		
	</div>
</body>
	
</html>